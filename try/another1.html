<!DOCTYPE html>
<html>
<head>
	<title>Week3</title>
	<style type="text/css">
		body{
			background-color:  	#F5F5DC;
			background-image: url('lab.jpg');
		}
		#workspace{
			top:0px;
			width: 100%;
		}
		#meter1{
			width: 100px;
			height: 500px;
			float:left;
		}
		#meter2{
			float: left;
			margin-left: 100px;
			width: 100px;
			height: 500px;
		}
		#flask{
			width: 100px;
			height: 500px;
		}

		#meter3{
			margin-left: 100px;
			width: 100px;
			height: 500px;
			float: center;
			display: none;
		}
		.square{
			height: 18px;
			width: 48px;
			background-color: red;
			transform: translate(-15px, -5px);
			text-align: center;
		}

		.draggable{
			width: 18px;
			height: 18px;
			transform: translate(41px, 415px);
		}

		p{
			margin:0px;
		}

		.groove{
			margin-left: 45px;
			width: 9px;
			height: 400px;
			background-color: black;
		}
		#container{
			background-color: rgb(204, 224, 224);
			margin-top: 425px;
			margin-left: 100px;
			height: 45px;
			width: 300px;
			border: solid;
		}
		.square1 {
			  background: red;
			  width: 100px;
			  height: 100px;
			  margin: 50px auto;
			}
		.circle {
		  position: absolute;
       	  content: ' \25CF';
		  font-size: 20px;
		  border-radius: 50px;
		}
		#button {
		    background-color: #4CAF50; /* Green */
		    border: none;
		    color: white;
		    margin-left:-38px;
		    padding: 10px 20px;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 16px;
		}
	</style>
</head>
<body>
	<script type="text/javascript" src="http://code.interactjs.io/v1.2.9/interact.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<div id="workspace">
		<div id="meter1" style="margin-left:50px;margin-top: 50px;">
			<h3 style="margin-left:20%">FeCl3</h3>
			<div class="draggable" id="solute">
				<div class='square' id="solute">0</div>
			</div>
			<div id="solute" class="groove"></div>
		</div>

		<div id="meter2" style="margin-top: 50px;">
			<h3 style="margin-left:19%">Water</h3>
			<div class="draggable" id="solvent">
				<div class='square' id="solvent">0</div>
			</div>
			<div class="groove" id="solvent"></div>
		</div>
		<div style="float:left;text-align:center;height:100px;width:500px; align-self:center; margin-top: 50px; margin-left: 50px;">
			<h3>Temperature</h3><br />
			<input type="text" name="heat" style="margin-left: 50px;" id="heat"/><br /><br />
			<button onclick="getFnc()" id="button">Submit</button>
		</div> 
		<div class="svg" id="unique" style="text-align: center;float: left;margin-left: 500px;margin-top: 0px;">
			<div id="img" style="width: 1000px;">
				<img src="an.svg"/>
			</div>
		</div>
		
		<div id="flask">
			<div id="container" style="position:fixed;top:0px;text-align: center;margin-left: 500px;"></div>
		</div> 
		<div>
			<button id="button" onclick="remove()">REMOVE GRAPH</button>
			<button id="button" onclick="show()" id="graph">SHOW GRAPH</button>
		</div>
		<canvas id="myCanvas"></canvas>
		<div id="meter3">
			<div class='square'></div>
			<div class="groove"></div>
		</div>
	</div>
	
	<script type="text/javascript">
	var PREVW=0;
	var PREVF=0;
	var heat=0;
	var myVinyls = {
    "Solute":0,
    "Solvent":0,
	};
	var ctx = document.getElementById("myCanvas").getContext("2d");
		ctx.canvas.width = 100;
		ctx.canvas.height = 250;
	$('#container').hover(function(){
		var cur = $(this);
		cur.css("cursor", "pointer");
	});
	var getFnc=function(){
		heat=document.getElementById('heat').value;
		document.getElementById('heat').value=null;
	}
	var circle_water=function(){
		var div1=document.getElementById('img');
		var circle = document.createElement('span');
		circle.className = 'circle';
		//left -700 -300
		// top 100 400
		var x=Math.floor(Math.random() * 300) +390
		x*=-1;
		var y=Math.floor(Math.random() * 300) + 120
		console.log(x);
		circle.style.marginTop=String(y)+"px";
		circle.style.marginLeft=String(x)+"px";
		circle.style.color="blue";
		circle.style.border="solid";
		circle.style.borderRadius="75%";
		div1.appendChild(circle);
	}
	var circle_f=function(){
		var div1=document.getElementById('img');
		var circle = document.createElement('span');
		circle.className = 'circle';
		//left -700 -300
		// top 100 400
		var x=Math.floor(Math.random() * 300) + 390
		x*=-1;
		var y=Math.floor(Math.random() * 300) + 120
		circle.style.marginTop=String(y)+"px";
		circle.style.marginLeft=String(x)+"px";
		circle.style.borderRadius="25%";
		circle.style.color="brown";
		circle.style.border="solid";
		div1.appendChild(circle);
	}
	function drawLine(ctx, startX, startY, endX, endY,color){
	    ctx.save();
	    ctx.strokeStyle = color;
	    ctx.beginPath();
	    ctx.moveTo(startX,startY);
	    ctx.lineTo(endX,endY);
	    ctx.stroke();
	    ctx.restore();
	}
	function drawBar(ctx, upperLeftCornerX, upperLeftCornerY, width, height,color){
	    ctx.save();
	    ctx.fillStyle=color;
	    ctx.fillRect(upperLeftCornerX,upperLeftCornerY,width,height);
	    ctx.restore();
	}
	function remove(){
		document.getElementById('myCanvas').remove();
	}
	var Barchart = function(options){
	    this.options = options;
	    this.canvas = options.canvas;
	    this.ctx = this.canvas.getContext("2d");
	    this.colors = options.colors;
	    this.draw = function(){
	        var maxValue = 0;
	        for (var categ in this.options.data){
	            maxValue = Math.max(maxValue,this.options.data[categ]);
	        }
	        var canvasActualHeight = this.canvas.height - this.options.padding * 2;
	        var canvasActualWidth = this.canvas.width - this.options.padding * 2;
	        //drawing the grid lines
	        var gridValue = 0;
	        while (gridValue <= maxValue){
	            var gridY = canvasActualHeight * (1 - gridValue/maxValue) + this.options.padding;
	            drawLine(
	                this.ctx,
	                0,
	                gridY,
	                this.canvas.width,
	                gridY,
	                this.options.gridColor
	            ); 
	            //writing grid markers
	            this.ctx.save();
	            this.ctx.fillStyle = this.options.gridColor;
	            this.ctx.font = "bold 10px Arial";
	            this.ctx.fillText(gridValue, 10,gridY - 2);
	            this.ctx.restore();
	 
	            gridValue+=this.options.gridScale;
	        }
	        //drawing the bars
	        var barIndex = 0;
	        var numberOfBars = Object.keys(this.options.data).length;
	        var barSize = (canvasActualWidth)/numberOfBars;
	 
	        for (categ in this.options.data){
	            var val = this.options.data[categ];
	            var barHeight = Math.round( canvasActualHeight * val/maxValue) ;
	            drawBar(
	                this.ctx,
	                this.options.padding + barIndex * barSize,
	                this.canvas.height - barHeight - this.options.padding,
	                barSize,
	                barHeight,
	                this.colors[barIndex%this.colors.length]
	            );
	 
	            barIndex++;
	        }
	  
	    }
	}
	var myBarchart = new Barchart(
    {
        canvas:myCanvas,
        padding:10,
        gridScale:5,
        gridColor:"#eeeeee",
        data:myVinyls,
        colors:["#A52A2A","#67b6c7", "#bccd7a","#eb9743"]
    }
);
		function show(){
			if(myVinyls["Solvent"]==0){
					window.alert('Please Add Some Solvent');
			}
			else{
				myBarchart.draw();
			}
		};
		interact('.draggable')

		.draggable({
		autoScroll: true,
		onmove: dragMoveListener
			});

		function dragMoveListener (event) {
			if(event.target.id=="solute"){
				if(heat==0){
					window.alert('heat it first');
					return;
				}	
			}
			var target = event.target
			y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
			groove_length=parseInt(window.getComputedStyle(event.target.parentNode.querySelector(".groove")).height, 10)
			if(y<=0 && y>=(-groove_length))
			{
				target.style.webkitTransform = target.style.transform ='translate(41px, ' + (420+y) + 'px)';
				target.setAttribute('data-y', y);

				p=event.target.querySelector('div')
				p.innerHTML=-(y/400)
				if(event.target.id=="solute"){
					myVinyls["Solute"]=-(y/20);
					if(heat>=30){
						if(-(y/20)>PREVF){
							for(var i=0;i<1;i++){
							circle_f();
							}	
						}
						PREVF=-(y/20)
					}
					else{
						window.alert('heat more to see the effect');
						return;
					}
				}
				else if(event.target.id=="solvent"){
					myVinyls["Solvent"]=-(y/20);
					if(-(y/20)>PREVW){
						for(var i=0;i<1;i++){
						circle_water();
						}	
					}
					PREVW=-(y/20)
				}
				if(event.target.parentNode.id=="meter2")
				{
					container=document.getElementById("container")
					container.style.marginTop=(425+y)+"px"
				}

				squares=document.getElementsByClassName("square")
				solute=squares[0].innerHTML
				solution=0.2+parseFloat(squares[1].innerHTML, 3)
				molarity=solute/solution
				y_meter3=molarity*80
				meter3=squares[2]
				meter3.style.marginTop=(400-y_meter3)+"px"
				meter3.innerHTML=molarity

				container=document.getElementById("container")
				color=parseInt((224-((molarity/5)*224))).toString()
				container.style.backgroundColor="rgb(255, "+color+", "+color+")"
			}
		}

		window.dragMoveListener = dragMoveListener;
		for(var i=0;i<50;i++)circle_water();
	</script>
</body>
</html>
